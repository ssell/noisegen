var UIMultiRangeThumb=function(a,b,c){this.parent=a;this.index=b;this.value=c;this.parentObj=a.backgroundObj;this.obj=null;this.selected=!1;this.prevX=0};UIMultiRangeThumb.prototype.recalculateValue=function(){var a=parseInt(this.parentObj.css("width"));this.value=this.pos/a*(this.parent.max-this.parent.min)};UIMultiRangeThumb.prototype.positionVertical=function(){var a=parseInt(this.parentObj.css("height")),b=parseInt(this.obj.css("height"));a&&b&&this.obj.css("margin-top",-(.5*(b-a)))};
UIMultiRangeThumb.prototype.positionHorizontal=function(){var a=parseInt(this.parentObj.css("width"));parseInt(this.obj.css("height"));var b=(this.value-this.parent.min)/this.parent.max,b=Math.min(Math.max(b,0),1),b=b*a;this.obj.css("margin-left",b);this.pos=b};UIMultiRangeThumb.prototype.update=function(){this.positionVertical();this.positionHorizontal()};
UIMultiRangeThumb.onMouseMove=function(a,b){if(b.selected){var c=a.pageX-b.prevX,d=parseInt(b.parentObj.css("width")),e=parseInt(b.obj.css("margin-left")),c=Math.min(Math.max(e+c,0),d);e!=c&&(e=b.parent.getThumbPos(b.index-1),d=b.parent.getThumbPos(b.index+1),0==e&&(e=-1),c>e&&c<d&&(b.obj.css("margin-left",c),b.pos=c,b.prevX=a.pageX,b.recalculateValue(),b.parent.onThumbUpdate(b)))}else b.obj.unbind("mousemove")};
UIMultiRangeThumb.onMouseUp=function(a,b){b.obj.removeClass("multirange_thumb_selected");b.selected=!1};UIMultiRangeThumb.onMouseDown=function(a,b){b.obj.addClass("multirange_thumb_selected");b.prevX=a.pageX;b.selected=!0;$(document).mousemove(function(a){UIMultiRangeThumb.onMouseMove(a,b)});$(document).mouseup(function(a){UIMultiRangeThumb.onMouseUp(a,b)})};
UIMultiRangeThumb.prototype.build=function(){this.parentObj.append("<div class='multirange_thumb' />");this.obj=this.parentObj.find(".multirange_thumb").last();this.positionVertical();this.positionHorizontal();var a=this;this.obj.mousedown(function(b){UIMultiRangeThumb.onMouseDown(b,a)})};UIMultiRangeThumb.prototype.destroy=function(){this.obj.remove()};var UIMultiRangeSegmentEditor=function(a,b){this.parent=a;this.parentObj=a.obj;this.segment=b;this.color=b.color};
UIMultiRangeSegmentEditor.prototype.bindActions=function(){var a=this;$(document).mouseup(function(b){a.obj.is(b.target)||0!==a.obj.has(b.target).length||a.obj.remove()});$("#multirange_segment_editor_color").spectrum({color:this.color,showPalette:!1,appendTo:this.obj,containerClassName:"multirange_colorpick_container",replacerClassName:"multirange_colorpick_replacer",showButtons:!1});$("#multirange_segment_editor_color").change(function(b){b=$(this).spectrum("get").toHexString();a.segment.setColor(b);
a.parent.update()});$("#multirange_segment_editor_mode").change(function(b){a.segment.setMode($(this).val())});$("#multirange_segment_editor_split").click(function(b){a.parent.splitSegment(a.segment)});$("#multirange_segment_editor_remove").click(function(b){a.parent.removeSegment(a.segment);a.obj.remove()})};
UIMultiRangeSegmentEditor.prototype.build=function(){this.parentObj&&(this.parentObj.append("<div class='multirange_segment_editor'><table class='multirange_table'><tr><td width='50%'>Color</td><td width='50%'><input id='multirange_segment_editor_color' type='text'></td></tr><tr><td>Mode</td><td><select id='multirange_segment_editor_mode' class='multirange_select'><option"+("Solid"==this.segment.mode?" selected='selected'":"")+">Solid</option><option"+("Smooth RGB"==this.segment.mode?" selected='selected'":
"")+">Smooth RGB</option><option"+("Smooth HSV"==this.segment.mode?" selected='selected'":"")+">Smooth HSV</option><option"+("None"==this.segment.mode?" selected='selected'":"")+">None</option></select></td></table><hr><div class='multirange_button_holder'><button type='button' id='multirange_segment_editor_split' class='multirange_button' "+(12>this.segment.width?"disabled":"")+">Split</button><button type='button' id='multirange_segment_editor_remove' class='multirange_button' "+(1>=this.parent.segments.length?
"disabled":"")+">Remove</button></div></div>"),this.obj=this.parentObj.find(".multirange_segment_editor").last(),this.bindActions())};var UIMultiRangeSegment=function(a,b,c,d,e,f){this.parent=a;this.parentObj=a.backgroundObj;this.index=b;this.editable=c;this.colorRight=this.color=d;this.mode=e;this.obj=null;this.width=this.pos=0;this.callback=f};
UIMultiRangeSegment.prototype.calculatePosWidth=function(){var a=this.parent.getThumbPos(this.index-1),b=this.parent.getThumbPos(this.index);this.pos=a;this.width=b-a};UIMultiRangeSegment.prototype.updateLerpValues=function(){var a=this.parent.getSegment(this.index+1);this.colorRight=a?a.color:this.color};
UIMultiRangeSegment.prototype.updateBackground=function(){this.obj.css("background","");this.obj.css("background-color",this.color);switch(this.mode){case "Smooth RGB":case "Smooth HSV":this.updateLerpValues();var a=", "+this.color+", "+this.color+", "+this.colorRight,b="-moz-linear-gradient(left"+a+")",c="linear-gradient(to right"+a+")";this.obj.css({background:"-webkit-linear-gradient(left"+a+")"}).css({background:b}).css({background:c});break;case "None":this.obj.css("background-color","#CCCCCC")}};
UIMultiRangeSegment.prototype.update=function(){this.calculatePosWidth();this.updateBackground();this.obj.css("margin-left",this.pos);this.obj.css("width",this.width);this.callback&&this.callback()};UIMultiRangeSegment.prototype.setMode=function(a){this.mode=a;this.update()};UIMultiRangeSegment.prototype.setColor=function(a){this.color=a;this.update()};
UIMultiRangeSegment.prototype.bindActions=function(){if(this.editable){var a=this.parent,b=this;this.obj.click(function(){(new UIMultiRangeSegmentEditor(a,b)).build()})}};
UIMultiRangeSegment.prototype.build=function(){var a="multirange_segment";this.editable&&(a+=" multirange_segment_editable");this.parentObj.append("<div class='"+a+"' />");this.obj=this.parentObj.find(".multirange_segment").last();this.calculatePosWidth();this.updateBackground();this.obj.css("margin-left",this.pos);this.obj.css("width",this.width);this.bindActions()};UIMultiRangeSegment.prototype.destroy=function(){this.obj.remove()};
var UIMultiRange=function(a,b){this.id=a;this.callback=b;this.obj=$("#"+a);this.editable=!1;this.max=this.min=this.step=this.count=0;this.segments=this.thumbs=null};UIMultiRange.prototype.update=function(){for(var a=0;a<this.thumbs.length;++a)this.thumbs[a].update();for(a=0;a<this.segments.length;++a)this.segments[a].update()};UIMultiRange.prototype.buildBackground=function(){this.obj.append("<div class='multirange_background'></div>");this.backgroundObj=this.obj.find(".multirange_background").last()};
UIMultiRange.prototype.buildThumbs=function(){var a=this.obj.data("rangevalues"),b=[];a&&(b=a.split(","));for(a=0;a<this.count;++a)this.thumbs[a]=a<b.length?new UIMultiRangeThumb(this,a,Number(b[a])):new UIMultiRangeThumb(this,a,0),this.thumbs[a].build()};
UIMultiRange.prototype.buildSegments=function(){var a=this.obj.data("rangecolors"),b=[];a&&(b=a.split(","));var c=this.obj.data("rangetypes"),a=[];c&&(a=c.split(","));for(var d,e=0;e<this.count+1;++e)c=e<b.length?b[e]:"#000000",d=e<a.length?a[e]:"none",this.segments[e]=new UIMultiRangeSegment(this,e,this.editable,c,d,this.callback),this.segments[e].build()};
UIMultiRange.prototype.build=function(){if(this.obj){this.obj.empty();var a=this.obj.data("rangeedit");a&&(a=String(a).toLocaleLowerCase(),this.editable=0==a.localeCompare("true"));this.count=Number(this.obj.data("rangecount"));this.step=Number(this.obj.data("rangestep"));this.min=Number(this.obj.data("rangemin"));this.max=Number(this.obj.data("rangemax"));this.thumbs=Array.apply(0,Array(this.count)).map(function(){});this.segments=Array.apply(0,Array(this.count+1)).map(function(){});this.buildBackground();
this.buildThumbs();this.buildSegments()}};
UIMultiRange.prototype.load=function(a,b,c){for(var d=0;d<this.thumbs.length;++d)this.thumbs[d].destroy();for(d=0;d<this.segments.length;++d)this.segments[d].destroy();this.count=a.length;this.thumbs=Array.apply(0,Array(this.count)).map(function(){});this.segments=Array.apply(0,Array(this.count+1)).map(function(){});for(d=0;d<this.thumbs.length;d++)this.thumbs[d]=new UIMultiRangeThumb(this,d,a[d]),this.thumbs[d].build();for(d=0;d<this.segments.length;d++)this.segments[d]=new UIMultiRangeSegment(this,
d,this.editable,b[d],c[d],this.callback),this.segments[d].build();this.update()};UIMultiRange.prototype.onThumbUpdate=function(a){a=a.index;var b=a-1,c=a+1;this.segments[a].update();this.segments[c].update();0<=b&&this.segments[b].update();this.callback&&this.callback()};UIMultiRange.prototype.getThumbPos=function(a){return 0>a?0:a<this.thumbs.length?this.thumbs[a].pos:parseInt(this.backgroundObj.css("width"))};
UIMultiRange.prototype.getSegment=function(a){var b=null;0<=a&&a<this.segments.length&&(b=this.segments[a]);return b};
UIMultiRange.prototype.splitSegment=function(a){if(a){var b=a.index;if(1==this.segments.length)this.thumbs.push(new UIMultiRangeThumb(this,0,.5*(this.max-this.min))),this.thumbs[0].build(),this.segments.push(new UIMultiRangeSegment(this,1,a.editable,a.color,a.mode)),this.segments[this.segments.length-1].build(),this.segments[b].update();else{var c=b-1;if(0>c){this.thumbs.splice(0,0,new UIMultiRangeThumb(this,0,.5*this.thumbs[b].value));this.thumbs[0].build();for(c=1;c<this.thumbs.length;++c)this.thumbs[c].index=
c;this.segments.splice(0,0,new UIMultiRangeSegment(this,0,a.editable,a.color,a.mode,this.callback));this.segments[0].build();for(c=1;c<this.segments.length;++c)this.segments[c].index=c;this.segments[1].update()}else{if(b==this.thumbs.length)c=this.thumbs[c].value,this.thumbs.push(new UIMultiRangeThumb(this,b,.5*(this.max-c)+c)),this.thumbs[b].build(),this.segments.push(new UIMultiRangeSegment(this,b+1,a.editable,a.color,a.mode,this.callback)),this.segments[b+1].build();else{c=this.thumbs[c].value;
this.thumbs.splice(b,0,new UIMultiRangeThumb(this,b,.5*(this.thumbs[b].value-c)+c));this.thumbs[b].build();for(c=b;c<this.thumbs.length;++c)this.thumbs[c].index=c;this.segments.splice(b,0,new UIMultiRangeSegment(this,b,a.editable,a.color,a.mode,this.callback));this.segments[b].build();for(c=b;c<this.segments.length;++c)this.segments[c].index=c}this.segments[b].update()}}}};
UIMultiRange.prototype.removeSegment=function(a){if(a&&1<this.segments.length){a=a.index;var b=a-1;if(a==this.segments.length-1){this.thumbs[b].destroy();this.thumbs.splice(b,1);for(var c=0;c<this.thumbs.length;++c)this.thumbs[c].index=c;this.segments[a].destroy();this.segments.splice(a,1);for(c=0;c<this.segments.length;++c)this.segments[c].index=c;this.segments[this.segments.length-1].update()}else if(1<=a){var c=this.thumbs[b].value,d=.5*(this.thumbs[a].value-c)+c;this.thumbs[b].destroy();this.thumbs.splice(b,
1);for(c=0;c<this.thumbs.length;++c)this.thumbs[c].index=c;this.thumbs[b].value=d;this.thumbs[b].update();this.segments[a].destroy();this.segments.splice(a,1);for(c=0;c<this.segments.length;++c)this.segments[c].index=c,this.segments[c].update()}else{this.thumbs[a].destroy();this.thumbs.splice(0,1);for(c=0;c<this.thumbs.length;++c)this.thumbs[c].index=c;this.segments[0].destroy();this.segments.splice(0,1);for(c=0;c<this.segments.length;++c)this.segments[c].index=c;this.segments[0].update()}}};
function buildMultiRanges(a,b){var c=[];a&&a.find(".multirange").each(function(){c.push(new UIMultiRange($(this).attr("id"),b));c[c.length-1].build()});return c}function toPaletteDescriptor(a){var b=[];if(a)for(var c=0;c<a.segments.length;++c){var d=a.segments[c].mode,e=tinycolor(a.segments[c].color).toRgb();if(e){var f;f=0==c?0:parseInt(a.thumbs[c-1].value);b.push(f+","+e.r+","+e.g+","+e.b+","+d)}}return b}
function rgbToHex(a,b,c){a=a.toString(16);b=b.toString(16);c=c.toString(16);return"#"+(1==a.length?"0"+a:a)+(1==b.length?"0"+b:b)+(1==c.length?"0"+c:c)}var NoiseProgressBar=function(){};NoiseProgressBar.start=function(a,b){NoiseProgressBar.startTime=performance.now();NoiseProgressBar.total=a;NoiseProgressBar.current=0;$("#progress_bar").show();$("#progress_bar").css("width","0%");b&&($("#progress_bar_title").text(b),console.log("title: "+b))};
NoiseProgressBar.stop=function(){NoiseProgressBar.stopTime=performance.now();$("#progress_bar").hide();$("#progress_bar").css("width","0%");$("#progress_bar_title").text("");console.log("Progress finished after "+(NoiseProgressBar.stopTime-NoiseProgressBar.startTime)+"ms")};NoiseProgressBar.update=function(a){NoiseProgressBar.current+=a;a=NoiseProgressBar.current/NoiseProgressBar.total*100;$("#progress_bar").css("width",a+"%")};NoiseProgressBar.setTitle=function(a){$("#progress_bar_title").text(a)};
NoiseProgressBar.elapsed=function(){return NoiseProgressBar.stopTime-NoiseProgressBar.startTime};NoiseProgressBar.total=0;NoiseProgressBar.current=0;NoiseProgressBar.active=!1;NoiseProgressBar.startTime=0;NoiseProgressBar.stopTime=0;function toTitleCase(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})}
function buildTitle(a,b,c){for(var d="<div class='ui_holder ui_title'>",e=a.split("_"),f=0;f<e.length;++f)d+=toTitleCase(e[f])+" ";d+=": ";return c?d+("<div id='"+a+"_value' class='noise_property_value' style='display:none;'>"+b+"</div></div>"):d+("<input id='"+a+"_value' class='noise_property_value' type='number' value='"+b+"'></div>")}function buildNumber(a,b){return"<div class='ui_holder'><input id='"+a+"' class='ui_element' type='number' value='"+b+"'></div>"}
function buildRangeInt(a,b,c,d){var e=Math.trunc(.01*(Number(c)-Number(b)));1>e&&(e=1);return"<div class='ui_holder'><table class='ui_table'><tr><td width='15%' style='text-align: right;'>"+b+"</td><td width='60%'><input class='ui_element ui_range' id='"+a+"' type='range' min='"+b+"' max='"+c+"' value='"+d+"' step='"+e+"'></td><td width='15%' style='text-align: left;'>"+c+"</td></tr></table></div>"}
function buildRangeFloat(a,b,c,d){return"<div class='ui_holder'><table class='ui_table'><tr><td width='15%' style='text-align: right;'>"+b+"</td><td width='60%'><input class='ui_element ui_range' id='"+a+"' type='range' min='"+b+"' max='"+c+"' value='"+d+"' step='"+.01*(Number(c)-Number(b))+"'></td><td width='15%' style='text-align: left;'>"+c+"</td></tr></table></div>"}
function buildSelect(a,b){for(var c="<div class='ui_holder'><select id='"+a+"' class='ui_element'>",d=1;d<b.length;++d)c+="<option value='"+b[d]+"'>"+b[d]+"</option>";return c+"</select></div>"}
function buildUI(a){var b="";a=a.split(";");for(var c=0;c<a.length;++c){var b=b+"<div>",d=a[c].split(":"),e=d[0];if(e.length)switch(d=d[1].split(" "),d[0]){case "number":b+=buildTitle(e,d[1],!0);b+=buildNumber(e,d[1]);break;case "int_range":b+=buildTitle(e,d[3]);b+=buildRangeInt(e,d[1],d[2],d[3]);break;case "float_range":b+=buildTitle(e,d[3]);b+=buildRangeFloat(e,d[1],d[2],d[3]);break;case "select":b+=buildTitle(e,d[1],!0),b+=buildSelect(e,d)}b+="</div>"}$("#noise_content").empty();$("#noise_content").append(b)}
;