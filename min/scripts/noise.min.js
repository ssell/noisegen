var $jscomp={scope:{},inherits:function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]}};function clamp(a,b,c){return Math.min(Math.max(a,b),c)}function int32(a){return a|0}function uint32(a){return a>>>0}function mod(a,b){return(a%b+b)%b}function interpolateLinear(a,b,c){c=clamp(c,0,1);return a*(1-c)+b*c}
function interpolateCosine(a,b,c){c=clamp(c,0,1);c=.5*(1-Math.cos(c*Math.PI));return a*(1-c)+b*c}function dot2(a,b){return a[0]*b[0]+a[1]*b[1]}function gaussianRand(a){this.generate=!0;var b=this.value1=this.value0=0;if(this.generate){var c,d;do b=2*a.nextf()-1,c=2*a.nextf()-1,d=b*b+c*c;while(1<=d);d=Math.sqrt(-2*Math.log(d)/d);this.value0=b*d;this.value1=c*d;b=this.value0}this.generate=!this.generate;return b}function gaussianRandAdjusted(a,b,c){return gaussianRand(a)*c+b}
function radiusSample(a){var b={x:0,y:0};if(a){var c=(.5*(Math.sqrt(a)-1)|0)+1;a=2*Math.PI/(8*c)*(a-(4*c*c-4*c+1));b.x=c*Math.cos(a);b.y=c*Math.sin(a)}return b}function radiusSampleRadius(a){return(.5*(Math.sqrt(a)-1)|0)+1}function cantorPair(a,b){return(a+b)*(a+b+1)*.5+b}var Random=function(){this.seed=0;this.max=1};Random.prototype.setSeed=function(a){this.seed=uint32(a)};Random.prototype.nextUnbound=function(){return 0};
Random.prototype.next=function(a,b){var c=this.nextUnbound();return a+uint32(c*Random.maxRecip*(b-a))};Random.prototype.nextf=function(){return this.nextUnbound()*Random.maxRecip};Random.phi=1.618033988749895;Random.max=4294967296;Random.maxRecip=1/(Random.max+1);var RandomXorShift32=function(){Random.call(this);this.state=0};$jscomp.inherits(RandomXorShift32,Random);RandomXorShift32.maxRecip=Random.maxRecip;RandomXorShift32.max=Random.max;RandomXorShift32.phi=Random.phi;
RandomXorShift32.prototype.setSeed=function(a){Random.prototype.setSeed.call(this,uint32(a));this.state=this.seed};RandomXorShift32.prototype.nextUnbound=function(){var a=this.state,a=uint32(a^uint32(a<<13)),a=uint32(a^uint32(a>>17));return this.state=a=uint32(a^uint32(a<<5))};RandomXorShift32.type="XorShift32";var RandomXorShift128=function(){Random.call(this);this.stateShift=[0,239006280,397831840,88675123];this.state=[0,0,0,0]};$jscomp.inherits(RandomXorShift128,Random);
RandomXorShift128.maxRecip=Random.maxRecip;RandomXorShift128.max=Random.max;RandomXorShift128.phi=Random.phi;RandomXorShift128.prototype.setSeed=function(a){Random.prototype.setSeed.call(this,uint32(a));for(a=0;4>a;++a)this.state[a]=uint32(this.seed+this.stateShift[a])};
RandomXorShift128.prototype.nextUnbound=function(){var a=uint32(this.state[0]^uint32(this.state[0]<<11));this.state[0]=this.state[1];this.state[1]=this.state[2];this.state[2]=this.state[3];this.state[3]=uint32(this.state[3]^uint32(this.state[3]>>19)^uint32(a^uint32(a>>8)));return this.state[3]};RandomXorShift128.type="XorShift128";var RandomWELL512=function(){Random.call(this);this.index=0;this.state=Array.apply(0,Array(16)).map(function(){});this.xor=new RandomXorShift128};
$jscomp.inherits(RandomWELL512,Random);RandomWELL512.maxRecip=Random.maxRecip;RandomWELL512.max=Random.max;RandomWELL512.phi=Random.phi;RandomWELL512.prototype.setSeed=function(a){Random.prototype.setSeed.call(this,uint32(a));this.xor.setSeed(a);for(a=0;16>a;++a)this.state[a]=this.xor.nextUnbound()};
RandomWELL512.prototype.nextUnbound=function(){var a,b,c,d;a=this.state[this.index];c=this.state[this.index+13&15];b=uint32(a^uint32(c^uint32(a<<16)^uint32(c<<15)));c=this.state[this.index+9&15];c=uint32(c^uint32(c>>11));a=this.state[this.index]=b^c;d=uint32(a^uint32(uint32(a<<5)&3661901088));this.index=this.index+15&15;a=this.state[this.index];this.state[this.index]=uint32(a^uint32(b^uint32(d^uint32(a<<2)^uint32(b<<18)^uint32(c<<28))));return this.state[this.index]};RandomWELL512.type="WELL512";
var RandomCMWC131104=function(){Random.call(this);this.qarray=Array.apply(0,Array(RandomCMWC131104.qsize)).map(function(){});this.c=362436;this.i=RandomCMWC131104.qsize-1};$jscomp.inherits(RandomCMWC131104,Random);RandomCMWC131104.maxRecip=Random.maxRecip;RandomCMWC131104.max=Random.max;RandomCMWC131104.phi=Random.phi;
RandomCMWC131104.prototype.setSeed=function(a){Random.prototype.setSeed.call(this,a);this.qarray[0]=this.seed;this.qarray[1]=this.seed+Random.phi;this.qarray[2]=this.seed+Random.phi+Random.phi;for(a=3;a<RandomCMWC131104.qsize;++a)this.qarray[a]=this.qarray[a-3]^this.qarray[a-2]^Random.phi^a};RandomCMWC131104.prototype.nextUnbound=function(){this.i=this.i+1&4095;var a=18782*this.qarray[this.i]+this.c;this.c=a>>32;this.qarray[this.i]=uint32(4294967294-a);return this.qarray[this.i]};
RandomCMWC131104.type="CMWC131104";RandomCMWC131104.qsize=4096;function CreateRandom(a){var b;switch(a){case RandomXorShift32.type:b=new RandomXorShift32;break;case RandomXorShift128.type:b=new RandomXorShift128;break;case RandomWELL512.type:b=new RandomWELL512;break;case RandomCMWC131104.type:b=new RandomCMWC131104}return b}var Noise=function(){this.params="";this.seed=1337;this.length=this.height=this.width=0};
Noise.prototype.setParam=function(a,b){var c=!0;switch(a){case "seed":this.seed=clamp(Number(b),17,999983);this.setSeed(this.seed);break;default:c=!1}return c};Noise.prototype.setParams=function(a){a=a.split(";");for(var b,c,d=0;d<a.length;++d)b=a[d].split(":"),c=b[0],b=b[1],this.setParam(c,b)};Noise.getParams=function(){return""};Noise.prototype.setSeed=function(a){this.seed=a};Noise.prototype.indexToXY=function(a,b,c){mod(a/4,this.width)};
Noise.prototype.xyToIndex=function(a,b){return 4*(b*this.width+a)};Noise.prototype.getPixelRaw=function(a,b){return 0};Noise.prototype.getPixel=function(a,b){return 0};Noise.prototype.setPixel=function(a,b,c,d,e,g,f){b=this.xyToIndex(b,c);a.data[b+0]=d;a.data[b+1]=e;a.data[b+2]=g;a.data[b+3]=f};Noise.prototype.setPixelUniform=function(a,b,c,d){b=this.xyToIndex(b,c);a.data[b+0]=d;a.data[b+1]=d;a.data[b+2]=d;a.data[b+3]=255};Noise.prototype.setRaw=function(a,b,c,d){a[c*this.width+b]=d};
Noise.prototype.generate=function(a,b,c,d,e){for(var g=e-d;b<c;++b){for(var f=d;f<e;++f){var k=this.getPixel(b,f);this.setPixelUniform(a,b,f,k)}postMessage({progress:g})}};Noise.prototype.generateRaw=function(a,b,c,d,e){for(var g=e-d;b<c;++b){for(var f=d;f<e;++f){var k=this.getPixelRaw(b,f);this.setRaw(a,b,f,k)}postMessage({progress:g})}};var NoiseRandom=function(){Noise.call(this);this.type="Random";this.prng=CreateRandom(RandomXorShift32.type)};$jscomp.inherits(NoiseRandom,Noise);
NoiseRandom.prototype.setParam=function(a,b){var c=Noise.prototype.setParam.call(this,a,b);if(!c)switch(a){case "prng":this.prng=CreateRandom(b),c=!0}return c};NoiseRandom.getParams=function(){return"prng:select "+RandomXorShift32.type+" "+RandomXorShift128.type+" "+RandomWELL512.type+" "+RandomCMWC131104.type+";"};NoiseRandom.prototype.setSeed=function(a){Noise.prototype.setSeed.call(this,a);this.prng.setSeed(a)};NoiseRandom.prototype.getPixelRaw=function(a,b){return this.prng.next(0,255)};
NoiseRandom.prototype.getPixel=function(a,b){return this.getPixelRaw(a,b)};NoiseRandom.type="Random";var NoisePerlin=function(){Noise.call(this);this.octaves=6;this.persistence=.5;this.scale=.01};$jscomp.inherits(NoisePerlin,Noise);NoisePerlin.prototype.setParam=function(a,b){var c=Noise.prototype.setParam.call(this,a,b);if(!c)switch(a){case "octaves":this.octaves=Number(b);c=!0;break;case "persistence":this.persistence=Number(b);c=!0;break;case "scale":this.scale=Number(b),c=!0}return c};
NoisePerlin.getParams=function(){return"octaves:int_range 1 20 6;persistence:float_range 0.0 1.0 0.6;scale:float_range 0.0001 0.1 0.02;"};NoisePerlin.prototype.getRandom=function(a,b){var c=int32(a)+int32(b)*(this.seed+1),c=c<<13^c;return 1-9.3132257E-10*int32(int32(int32(c*int32(int32(15731*int32(c*c))+789221))+1376312589)&2147483647)};
NoisePerlin.prototype.getSmoothNoise=function(a,b){var c=.0625*(this.getRandom(a-1,b-1)+this.getRandom(a+1,b-1)+this.getRandom(a-1,b+1)+this.getRandom(a+1,b+1)),d=.125*(this.getRandom(a-1,b)+this.getRandom(a+1,b)+this.getRandom(a,b-1)+this.getRandom(a,b+1)),e=.25*this.getRandom(a,b);return c+d+e};
NoisePerlin.prototype.getInterpolatedNoise=function(a,b){var c=int32(a),d=int32(b),e=a-c,g=b-d,f=this.getSmoothNoise(c,d),k=this.getSmoothNoise(c+1,d),h=this.getSmoothNoise(c,d+1),c=this.getSmoothNoise(c+1,d+1),f=interpolateLinear(f,k,e),e=interpolateLinear(h,c,e);return interpolateLinear(f,e,g)};NoisePerlin.prototype.getValue=function(a,b){for(var c=0,d=this.scale,e=1,g=0,f=0;f<this.octaves;++f)c+=this.getInterpolatedNoise(a*d,b*d)*e,d*=2,g+=e,e*=this.persistence;return c/g};
NoisePerlin.prototype.getPixelRaw=function(a,b){return this.getValue(a+this.seed,b+this.seed)};NoisePerlin.prototype.getPixel=function(a,b){return 127.5*(this.getPixelRaw(a,b)+1)};NoisePerlin.type="Perlin";var NoiseSimplex=function(){Noise.call(this);this.octaves=6;this.persistence=.5;this.scale=.01;this.prng=CreateRandom(RandomXorShift32.type);this.perm=Array(512)};$jscomp.inherits(NoiseSimplex,Noise);
NoiseSimplex.prototype.setParam=function(a,b){var c=Noise.prototype.setParam.call(this,a,b);switch(a){case "octaves":this.octaves=Number(b);c=!0;break;case "persistence":this.persistence=Number(b);c=!0;break;case "scale":this.scale=Number(b);c=!0;break;case "seed":this.prng.setSeed(this.seed);for(c=0;256>c;++c)this.perm[c]=this.prng.next(0,255),this.perm[c+256]=this.perm[c];c=!0}return c};NoiseSimplex.getParams=function(){return"octaves:int_range 1 20 9;persistence:float_range 0.0 1.0 0.52;scale:float_range 0.0001 0.1 0.0025;"};
NoiseSimplex.prototype.getRawNoise=function(a,b){var c=0,d=0,e=0,g=.36602540378*(a+b),f=int32(a+g),k=int32(b+g),g=.2113248654*(f+k),h=a-(f-g),m=b-(k-g),n=0,p=0;h>m?n=1:p=1;var q=h-n+.2113248654,r=m-p+.2113248654,g=h-1+.4226497308,t=m-1+.4226497308,l=int32(f&255),k=int32(k&255),f=mod(int32(this.perm[l+this.perm[k]]),12),n=mod(int32(this.perm[l+n+this.perm[k+p]]),12),p=mod(int32(this.perm[l+1+this.perm[k+1]]),12),l=.5-h*h-m*m;0<l&&(l*=l,c=l*l*dot2(NoiseSimplex.grad3[f],[h,m]));h=.5-q*q-r*r;0<h&&(h*=
h,d=h*h*dot2(NoiseSimplex.grad3[n],[q,r]));h=.5-g*g-t*t;0<h&&(h*=h,e=h*h*dot2(NoiseSimplex.grad3[p],[g,t]));return 70*(c+d+e)};NoiseSimplex.prototype.getValue=function(a,b){for(var c=0,d=this.scale,e=1,g=0,f=0;f<this.octaves;++f)c+=this.getRawNoise(a*d,b*d)*e,d*=2,g+=e,e*=this.persistence;return c/g};NoiseSimplex.prototype.getPixelRaw=function(a,b){return this.getValue(a+this.seed,b+this.seed)};NoiseSimplex.prototype.getPixel=function(a,b){return 127.5*(this.getPixelRaw(a,b)+1)};
NoiseSimplex.type="Simplex";NoiseSimplex.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];
NoiseSimplex.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],
[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];var NoiseWorley=function(){Noise.call(this);this.regionDimensions=16;this.dimensionRecip=.0625;this.nClosestPoints=this.densityStdDev=this.densityMean=3;this.prng=CreateRandom(RandomXorShift32.type);this.distances=null;this.currY=this.currX=0};$jscomp.inherits(NoiseWorley,Noise);
NoiseWorley.prototype.setParam=function(a,b){var c=Noise.prototype.setParam.call(this,a,b);if(!c)switch(a){case "region_dimensions":this.regionDimensions=Number(b);this.dimensionRecip=1/this.regionDimensions;c=!0;break;case "density_mean":this.densityMean=Number(b);c=!0;break;case "density_deviations":this.densityStdDev=Number(b);c=!0;break;case "n_closest_points":this.nClosestPoints=Number(b),c=!0}return c};NoiseWorley.getParams=function(){return"region_dimensions:int_range 64 256 128;n_closest_points:int_range 1 5 1;density_mean:int_range 1 10 3;density_deviations:int_range 1 5 1;"};
NoiseWorley.prototype.insertDistance=function(a){for(var b=0;b<this.nClosestPoints;++b){if(Infinity>this.distances[b]&&.01>Math.abs(a-this.distances[b]))return;if(a<this.distances[b])break}if(b<this.nClosestPoints){for(var c=this.nClosestPoints-1;c>b;--c)this.distances[c]=this.distances[c-1];this.distances[b]=a}};NoiseWorley.prototype.adjust=function(a){var b=a|0,c=0;0<a?c=1E-4<a-b?Math.ceil(a):b:0>a&&(c=-1E-4>a-b?a|0:b);return c};
NoiseWorley.prototype.checkRegion=function(a,b){var c=cantorPair(a,b);this.prng.setSeed(this.seed+c);for(var c=gaussianRandAdjusted(this.prng,this.densityMean,this.densityStdDev),d=0;d<c;++d){var e=a*this.regionDimensions+this.prng.nextf()*this.regionDimensions,g=b*this.regionDimensions+this.prng.nextf()*this.regionDimensions,e=e-this.currX,g=g-this.currY;this.insertDistance(e*e+g*g)}};
NoiseWorley.prototype.keepChecking=function(a){var b=!0,c=this.distances[this.nClosestPoints-1];if(Infinity>c){var d=radiusSampleRadius(a-1)-1;a=radiusSampleRadius(a)-1;d!=a&&(d*=this.regionDimensions,c<d*d&&(b=!1))}return b};NoiseWorley.prototype.resetDistances=function(){this.distances&&this.distances.length==this.nClosestPoints||(this.distances=Array(this.nClosestPoints));for(var a=0;a<this.nClosestPoints;++a)this.distances[a]=Infinity};
NoiseWorley.prototype.getValue=function(a,b){this.currX=a;this.currY=b;this.resetDistances();var c=a/this.regionDimensions|0,d=b/this.regionDimensions|0,e=0,g=c,f=d;do this.checkRegion(g,f),f=radiusSample(e++),g=c+this.adjust(f.x),f=d+this.adjust(f.y);while(this.keepChecking(e));return this.distances[this.nClosestPoints-1]};NoiseWorley.prototype.getPixelRaw=function(a,b){return this.getValue(a,b)};NoiseWorley.prototype.getPixel=function(a,b){return this.getPixelRaw(a,b)};NoiseWorley.type="Worley";
function createNoise(a){var b=null;switch(a){case NoiseRandom.type:b=new NoiseRandom;break;case NoisePerlin.type:b=new NoisePerlin;break;case NoiseSimplex.type:b=new NoiseSimplex;break;case NoiseWorley.type:b=new NoiseWorley}return b}function getUIParams(a){var b="";switch(a){case NoiseRandom.type:b=NoiseRandom.getParams();break;case NoisePerlin.type:b=NoisePerlin.getParams();break;case NoiseSimplex.type:b=NoiseSimplex.getParams();break;case NoiseWorley.type:b=NoiseWorley.getParams()}return b}
function runNoiseSingleDebug(a,b,c,d,e){b=createNoise(b);b.setParams(c);b.width=d;b.height=e;b.length=d*e;b.generateRaw(a,0,d,0,e)}
self.onmessage=function(a){var b=a.data;if(b){var c=b.isRaw;a=createNoise(b.noise);var d=b.width,e=b.height,g=b.startX,f=b.endX,k=b.startY,h=b.endY;a.setParams(b.noiseParams);a.width=d;a.height=e;a.length=d*e;c?(b=b.rawData,a.generateRaw(b,g,f,k,h),postMessage({rawData:b,startX:g,endX:f,startY:k,endY:h})):(a.generate(b.image,g,f,k,h),postMessage({image:b.image,startX:g,endX:f,startY:k,endY:h}))}};